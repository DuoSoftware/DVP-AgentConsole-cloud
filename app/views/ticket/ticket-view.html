<div ng-include="'app/views/ticket/template/new_sub_ticket.html'"></div>
<script type="text/ng-template" id="customTemplate.html">
    <a>
        <img class="assignee-icon" src="assets/img/avatar/defaultProfile.png" ng-src="{{match.model.avatar}}">
        <span ng-bind-html="match.label | uibTypeaheadHighlight:query"></span>
    </a>
</script>
<div class="animated fadeIn">
    <div ng-include="'app/views/ticket/ticket-edit.html'"></div>

    <div class="ticket-view-wrapper">
        <!-- MODEL HEADER -->
        <div class="model-header">
            <div class="col-md-9 nopadding">
                <div class="mode-left-icon  dark float-left ticket-model"
                     ng-class="{'api-channel':ticket.channel=='api',
                  'twitter-channel':ticket.channel=='twitter',
                  'call-channel':ticket.channel=='call',
                  'facebook-channel':ticket.channel=='facebook-post',
                  'sms-channel':ticket.channel=='sms',
                  'email-channel':ticket.channel=='email'}">
                    <i class=""
                       ng-class="{'fa fa-random':ticket.channel=='api',
                  'fa fa-twitter':ticket.channel=='twitter',
                   'fa fa-facebook':ticket.channel=='facebook-post',
                  'fa fa-phone':ticket.channel=='call',
                  'fa fa-bell-o':ticket.channel=='sms',
                  'fa fa-bookmark-o':ticket.channel=='new',
                  'fa fa-envelope-o':ticket.channel=='email'}"
                       ng-click="playFile(ticket.engagement_session._id)"></i>
                </div>
                <div class="model-header-text-wrap float-left">
                    <div>
                        </div><div class="model-header-text small">
                            {{ticket.reference}}/{{ticket.tid}}
                        </div>

                        <span ng-if="updateMessage" style="color:red;font-size: 20px;">{{updateMessage}}</span>
                    <div/>
                    <div class="model-header-text">
                        {{ ticket.subject | limitTo: 80 }}{{ticket.subject.length > 80 ? '...' : ''}}
                    </div>
                </div>
            </div>

            <div class="col-md-3 col-sm-4 nopadding">
                <div class="model-btn-wrapper">

                    <div class="btn-warp">
                        <span class="btn btn-template-primary btn-circle" ng-click="loadTicketSummary(ticket._id,true);" title="Refresh page">
                            <i class="fa fa-refresh"></i>
                        </span>
                    </div>
                    <div class="btn-warp ">
                        <span class="btn btn-template-primary btn-circle" ng-click="clickShowTickerEditMode();" title="Edit Ticket">
                            <i class="fa fa-pencil"></i>
                        </span>
                    </div>
                    <div class="btn-warp ">
                        <span class="btn btn-template-primary btn-circle" ng-click="goToComment()" title="Comments">
                            <i class="fa fa-comment"></i>
                        </span>
                    </div>
                    <div class="btn-warp " ng-show="!ticket.assignee">
                        <span class="btn btn-default btn-template-primary btn-circle" ng-click="assignToMe()" title="Assign to Me"><i class="fa fa-thumb-tack"></i></span>
                    </div>
                    <div class="btn-warp" uib-dropdown>
                        <span class="btn btn-template-primary btn-circle" title="Ticket Status" uib-dropdown-toggle>
                            <i class="main-icon-2-more-1"></i>
                        </span>

                        <ul class="dropdown-menu console-drop-menu ticket-view-option " uib-dropdown-menu
                            role="menu"
                            aria-labelledby="btn-append-to-single-button">
                            <li class="" role=""><a>Available status</a></li>
                            <div class="divider"></div>
                            <li class="menuitem" role="menuitem" ng-repeat="nextLevel in ticketNextLevels"><a
                                    ng-click="changeTicketStatus(nextLevel)">{{nextLevel}}</a>
                            </li>
                        </ul>
                    </div>
                    <!---<div class="btn-warp ">
                        <span class="btn btn-template-secondary btn-circle" id="closeTicket" ng-click="closeTicket()">
                            <i class="fa fa-times"></i>
                        </span>
                    </div>-->

                    <div ng-show="ticket.channel==='call'" class="btn-group" uib-dropdown is-open="status.isopen">
                        <button id="single-button" type="button" class="btn btn-primary" uib-dropdown-toggle
                                ng-disabled="disabled">
                            Call <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button" style="right: 0;left: auto">
                            <li role="menuitem" ng-repeat="no in contactList"><a href="javascript:void(0);"
                                                                                 ng-click="callToCustomer(no)">{{no}}</a>
                            </li>
                        </ul>
                    </div>

                    <div ng-show="ticketDetails.notificationData.activeSession" class="btn-group" uib-dropdown
                         is-open="status.isopen">
                        <span title="Map New Call Session To Existing Ticket." class="btn btn-default"
                              ng-click="updateTicketByReference();">Map</span>
                    </div>


                </div>
            </div>
        </div>
        <!-- MODEL HEADER -->

        <div class="ticker-details-wrapper">
            <div class="row">
                <div class="row">
                    <div class="col-lg-8 col-sm-12">

                        <!-- DETAILS -->
                        <div class="details-wrap">
                            <div class="details">
                                <h5>Details</h5>
                            </div>
                            <ul class="info-list-lg">
                                <li>
                                    <small>Type</small>
                                    <h5>{{ticket.type}}</h5>
                                </li>
                                <li>
                                    <small>Priority</small>
                                    <h5>
                                        <div id="prioritylvl" class="bg-checkbox small-details inline-btn"
                                             ng-class="{'red':ticket.priority=='urgent','orange':ticket.priority=='high','teal600':ticket.priority=='normal','gray300':ticket.priority=='low' }">
                                            {{ticket.priority}}
                                        </div>

                                    </h5>
                                </li>
                                <li>
                                    <small>Status</small>
                                    <h5>{{ticket.status}}</h5>
                                </li>
                                <li>
                                    <small>Business Unit</small>
                                    <h5>{{ticket.businessUnit}}</h5>
                                </li>
                                <li>
                                    <small>Company</small>
                                    <h5 ng-show="!ticket.companyName">{{ticket.companyName}}</h5>
                                    <h5 ng-show="ticket.companyName">{{ticket.companyName}}</h5>
                                </li>
                            </ul>
                        </div>

                        <div class="details-wrap">
                            <div class="details">
                                <h5>Dates</h5>
                            </div>
                            <ul class="info-list-lg">
                                <li>
                                    <small>Created</small>
                                    <h5>{{ticket.created_at}}</h5>
                                </li>
                                <li>
                                    <small>Updated</small>
                                    <h5>{{ticket.updated_at}}</h5>
                                    <!--<h5><time-ago from-time='{{ ticket.updated_at }}'></time-ago></h5>-->
                                </li>
                                <li>
                                    <small>Due To</small>
                                    <div class="bg-checkbox red font-white small-details inline-btn"
                                         ng-show="isOverDue">
                                        Overdue
                                    </div>
                                    <h5>{{ticket.due_at}}</h5>
                                </li>
                                <li>
                                    <small>Channel</small>
                                    <a style="margin-left: 10px" href="javascript:void(0);"
                                       ng-show="showPlayIcon && ticket.engagement_session && ( ticket.engagement_session.channel=='voicemail' || ticket.engagement_session.channel== 'call')"><i
                                            class="fa fa-play"
                                            ng-click="playFile(ticket.engagement_session._id)"></i></a>

                                    <h5 ng-if="ticket.engagement_session.channel">
                                        {{ticket.engagement_session.channel}} </h5>
                                    <h5 ng-if="!ticket.engagement_session.channel">Other</h5>
                                </li>


                            </ul>
                        </div>

                        <div class="details-wrap">
                            <div class="details">
                                <h5>Tags</h5>
                            </div>
                            <div ng-repeat="tag in ticket.tags" class="bg-checkbox inline-btn">
                                {{tag}}
                            </div>
                        </div>
                        <!-- END DETAILS -->

                        <!-- DESCRIPTION -->
                        <div class="ticket-dec-wrapper">
                            <div class="details">
                                <h5>Description</h5>
                            </div>

                            <small class="font-size-15">{{ticket.description}}
                            </small>
                        </div>

                        <!-- END DESC -->

                        <section class="ticket-dec-wrapper">
                           <div class="details">
                                <h5 class="pull-left"  style="margin-top: 10px;">Attachments</h5>

                                <div class="btn-template-primary btn-circle pull-right d-header-wrp d-h-r-icon"
                                         ng-click="isNavTicketAttachment = !isNavTicketAttachment" title="{{!isNavTicketAttachment ? 'Collapse' : 'Expand'}}">
                                    <i ng-if="!isNavTicketAttachment" class="fa fa-chevron-up"></i>
                                    <i ng-if="isNavTicketAttachment" class="fa fa-chevron-down"></i>
                                </div>
                            </div>
                           
                            <!-- call summary dsh productivity wrapper -->
                            <div class="row collapse" uib-collapse="isNavTicketAttachment">
                                <div class="ticket-attachment col-lg-6 col-md-6 colsm-12">
                                    <div class="details">
                                        <h5>Required Attachments</h5>
                                    </div>

                                    <!--<input id="fileSlotLoader" type="file" nv-file-select="" onchange="" uploader="uploader"/>-->
                                    <!--<input type="file" nv-file-select="" onchange="" uploader="uploader" multiple/>-->
                                    <div class="ticket-upload-view">
                                        <div class="row">
                                            <div ng-repeat="slot in ticket.slot_attachment" class="col-sm-3">
                                                <div class="thumbnail">
                                                    <div class="image view view-first">
                                                        <img style="width: 100%; display: block;"
                                                             ng-src={{internalThumbFileUrl}}/{{slot.attachment.url}}/SampleAttachment"
                                                             on-error-src="assets/img/noimage.jpg"
                                                             ng-if="isImage(slot.attachment.type)"/>
                                                        <img style="width: 100%; display: block;"
                                                             src="assets/img/noimage.jpg"
                                                             ng-if="!isImage(slot.attachment.type)"/>

                                                        <div class="mask">
                                                            <p>{{slot.attachment.file| limitTo:10}}</p>

                                                            <div class="tools tools-bottom">
                                                                <a href="javascript:void(0);"><i
                                                                        ng-if="isViewable(slot.attachment.type)"
                                                                        class="fa fa-play"
                                                                        ng-click="playAttachment(slot.attachment)"></i>

                                                                    <i ng-if="isImage(slot.attachment.type)"
                                                                       class="fa fa-expand"
                                                                       ng-click="playAttachment(slot.attachment)"></i>

                                                                    <i ng-if="!slot.attachment && !isSlotUploading"
                                                                       class="fa fa-cloud-upload"
                                                                       ng-click="uploadAttachmentToSlot(slot)"></i>
                                                                </a>
                                                                <a href="javascript:void(0);"><i ng-if="slot.attachment"
                                                                                                 class="fa fa-cloud-download"
                                                                                                 ng-click="downloadAttachment(slot.attachment)"></i></a>
                                                                <a href="javascript:void(0);"><i ng-if="slot.attachment"
                                                                                                 class="fa fa-times"
                                                                                                 ng-click="deleteSlotAttachment(slot)"></i></a>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-sm-4"></div>
                                                    <div class="col-sm-4"> {{slot.slot.name}}/{{slot.slot.fileType}}</div>
                                                    <div class="col-sm-4"></div>
                                                </div>

                                                <i class="fa fa-spinner fa-spin"
                                                   ng-if="isSlotUploading && (updationSlot.slot.name==slot.slot.name)">
                                                </i>
                                                <label ng-if="isSlotUploading && (updationSlot.slot.name==slot.slot.name)">Uploading........</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ATTACHMENT -->
                                <div class="ticket-attachment col-lg-6 col-md-6 colsm-12">
                                    <div class="details">
                                        <h5>Attachments</h5>
                                    </div>

                                    <!--<div ngf-drop ngf-select ng-model="newfile" class="drop-box dropdown-area"
                                         ngf-drag-over-class="'dragover'" ngf-multiple="true" ngf-allow-dir="true">Drop pdfs or images here or click to upload<i class="main-icon-2-upload-1"></i>
                                        Files:
                                        <ul>
                                            <li ng-repeat="f in files" style="font:smaller">{{f[0].name}} {{f.$error}} {{f.$errorParam}}</li>
                                        </ul>
                                    </div>
                                    <div ngf-no-file-drop>File Drag/Drop is not supported for this browser</div>


                                    <button ng-click="uploadAttchments()">Upload all</button>-->

                                    <div class="x_panel">
                                        <form id="demo-form2" data-parsley-validate class="form-horizontal form-label-left">
                                            <div ng-if="uploader.isHTML5">
                                                <div nv-file-drop="" uploader="uploader">
                                                    <div nv-file-over="" uploader="uploader"
                                                         over-class="another-file-over-class" class="upload-area bold">
                                                        Choose a file or drag it here.
                                                    </div>
                                                </div>
                                                <div class=" time-wrapper">
                                                    <uib-progressbar value="uploadProgress" type="warning">
                                                    </uib-progressbar>
                                                </div>
                                            </div>

                                            <!-- <div class="form-group" ng-show="uploader.queue.length>0">
                                                 <div class="col-md-12 col-sm-12 col-xs-12" ng-if="uploader.isHTML5">
                                                     <input type="file" nv-file-select="" uploader="uploader" multiple/>
                                                 </div>
                                             </div>
                                             <div class="form-group" ng-show="uploader.queue.length>0">
                                                 <div class="col-md-12 col-sm-12 col-xs-12">

                                                     <table class="table table-bordered">
                                                         <thead>
                                                         <tr>
                                                             <th width="50%">Name</th>
                                                             <th ng-show="uploader.isHTML5">Size</th>
                                                             <th ng-show="uploader.isHTML5">Progress</th>
                                                             <th>Status</th>
                                                             <th>Actions</th>
                                                         </tr>
                                                         </thead>
                                                         <tbody>
                                                         <tr ng-repeat="item in uploader.queue">
                                                             <td><strong>{{ item.file.name }}</strong></td>
                                                             <td ng-if="uploader.isHTML5" nowrap>{{ item.file.size/1024/1024|number:2 }}
                                                                 MB
                                                             </td>
                                                             <td ng-if="uploader.isHTML5">
                                                                 <div class="progress" style="margin-bottom: 0;">
                                                                     <div class="progress-bar" role="progressbar"
                                                                          ng-style="{ 'width': item.progress + '%' }"></div>
                                                                 </div>
                                                             </td>
                                                             <td class="text-center">
                                                                 <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span>
                                                                 <span ng-show="item.isCancel"><i class="glyphicon glyphicon-ban-circle"></i></span>
                                                     <span ng-if="item.isError"><i
                                                             class="glyphicon glyphicon-remove"></i></span>
                                                             </td>
                                                             <td nowrap>
                                                                 <button type="button" class="btn btn-success btn-xs"
                                                                         ng-click="item.upload()"
                                                                         ng-disabled="item.isReady || item.isUploading || item.isSuccess">
                                                                     <span class="glyphicon glyphicon-upload"></span> Upload
                                                                 </button>
                                                                 <button type="button" class="btn btn-warning btn-xs"
                                                                         ng-click="item.cancel()"
                                                                         ng-disabled="!item.isUploading">
                                                                     <span class="glyphicon glyphicon-ban-circle"></span> Cancel
                                                                 </button>
                                                                 <button type="button" class="btn btn-danger btn-xs"
                                                                         ng-click="item.remove()">
                                                                     <span class="glyphicon glyphicon-trash"></span> Remove
                                                                 </button>
                                                             </td>
                                                         </tr>

                                                         </tbody>
                                                     </table>
                                                 </div>
                                             </div>

                                             <div class="ln_solid" ng-show="uploader.queue.length>0"></div>
                                             <div class="form-group" ng-show="uploader.queue.length>0">
                                                 <label class="col-md-12 col-sm-12 col-xs-12">Queue progress</label>

                                                 <div class="col-md-12 col-sm-12 col-xs-12">
                                                     <div class="progress right" style="">
                                                         <div class="progress-bar" role="progressbar"
                                                              ng-style="{ 'width': uploader.progress + '%' }"></div>
                                                     </div>
                                                 </div>
                                             </div>
                                             <div class="form-group" ng-show="uploader.queue.length>0">
                                                 <div layout-gt-sm="row">

                                                     <button type="button" class="btn btn-success btn-s" ng-click="uploader.uploadAll()"
                                                             ng-disabled="!uploader.getNotUploadedItems().length">
                                                         <span class="glyphicon glyphicon-upload"></span> Upload all
                                                     </button>

                                                     <button type="button" class="btn btn-warning btn-s" ng-click="uploader.cancelAll()"
                                                             ng-disabled="!uploader.isUploading">
                                                         <span class="glyphicon glyphicon-ban-circle"></span> Cancel all
                                                     </button>

                                                     <button type="button" class="btn btn-danger btn-s" ng-click="uploader.clearQueue()"
                                                             ng-disabled="!uploader.queue.length">
                                                         <span class="glyphicon glyphicon-trash"></span> Remove all
                                                     </button>
                                                 </div>
                                             </div>-->
                                        </form>
                                    </div>


                                    <div class="ticket-upload-view">
                                        <div class="row">

                                            <div ng-repeat="attchment in uploadedAttchments" class="col-sm-6">
                                                <div class="thumbnail">
                                                    <div class="image view view-first">

                                                        <img style="width: 100%; display: block;"
                                                             ng-src={{internalThumbFileUrl}}/{{attchment.url}}/SampleAttachment"
                                                             on-error-src="assets/img/noimage.jpg"
                                                             ng-if="isImage(attchment.type)"/>
                                                        <img style="width: 100%; display: block;"
                                                             src="assets/img/noimage.jpg" ng-if="!isImage(attchment.type)"/>


                                                        <div class="mask">
                                                            <p>{{attchment.file| limitTo:10}}</p>

                                                            <div class="tools tools-bottom">
                                                                <a href="javascript:void(0);"><i
                                                                        ng-if="isViewable(attchment.type)" class="fa fa-play"
                                                                        ng-click="playAttachment(attchment)"></i>
                                                                    <i ng-if="isImage(attchment.type)" class="fa fa-expand"
                                                                       ng-click="playAttachment(attchment)"></i></a>
                                                                <a href="javascript:void(0);"><i class="fa fa-cloud-download"
                                                                                                 ng-click="downloadAttachment(attchment)"></i></a>
                                                                <a href="javascript:void(0);"><i class="fa fa-times"
                                                                                                 ng-click="deleteAttachment(attchment._id)"></i></a>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <!-- END-->
                            </div>
                        </section>
                        <!-- ./ end attachment -->


                        <!-- SUB TASK LIST -->
                        <div class="ticker-subticket-wrapper">
                            <div class="details">
                                <h5 class="pull-left ticket-subticket-title">Sub Ticket </h5>
                                <div class="btn-template-primary btn-circle pull-right cursor-pointer" ng-click="clickAddNewTicket()" title="Add Sub Ticket">
                                    <i class="fa fa-plus"></i></div>
                            </div>
                            <div ng-show=subTickets.length==0>
                                No sub-tickets assigned yet
                            </div>
                            <div ng-repeat="sub in subTickets">
                                <div class="sub-task" style="border-bottom: 0px solid">
                                    <div class="col-lg-7 col-sm-12 pull-left p-left-0 ">
                                        <div class="sub-description">
                                            <small ref ng-click="loadTicketView(sub)">{{sub.reference}}</small>
                                            {{sub.description}}
                                        </div>
                                        <div class="divider-gray"></div>

                                    </div>
                                    <div class="col-lg-5 col-sm-12 text-right  ">
                                        <a class="inline-bt pull-left " href="javascript:void(0);">
                                            <div class="pull-left commenter-img">
                                                <img src="assets/img/avatar/defaultProfile.png"
                                                     class="cursor-pointer"
                                                     ng-src={{sub.assignee.avatar}}>

                                                {{sub.assignee_displayname}}
                                            </div>
                                        </a>

                                        <div class="bg-checkbox gray300 small-details inline-btn">
                                            {{sub.status}}
                                        </div>
                                        <!--<div id="subPrioritylvl" class="bg-checkbox font-white small-details inline-btn"
                                             ng-class="{'red':sub.priority=='urgent','orange':sub.priority=='high','teal600':sub.priority=='normal','gray300':sub.priority=='low' }">
                                            {{sub.priority}}
                                        </div>-->
                                        <div class="bg-checkbox orange small-details inline-bt">
                                            {{sub.type}}
                                        </div>

                                        <!--<div class="bg-checkbox inline-bt link-btn">-->
                                            <!--<i class="main-icon-2-more-1 color-green500"></i>-->
                                        <!--</div>-->
                                    </div>
                                </div>

                            </div>

                        </div>
                        <!-- END -->

                        <!-- related ticket-->
                        <div class="ticker-subticket-wrapper">
                            <div class="details">
                                <h5>Related Ticket </h5>
                            </div>

                            <div ng-show=relTickets.length==0>
                                No related tickets assigned yet
                            </div>

                            <div ng-repeat="relticket in relTickets">
                                <div class="sub-task" style="border-bottom: 0px solid">
                                    <div class="col-lg-7 col-sm-12 pull-left p-left-0 ">
                                        <div class="sub-description">
                                            <small ng-click="loadTicketView(relticket)">{{relticket.reference}}</small>
                                            {{relticket.description}}
                                        </div>
                                        <div class="divider-gray"></div>
                                    </div>
                                    <div class="col-lg-5 col-sm-12 text-right  ">
                                        <a class="inline-bt pull-left " href="javascript:void(0);">
                                            <div class="pull-left commenter-img">
                                                <img src="assets/img/avatar/defaultProfile.png"
                                                     ng-src={{relticket.assignee.avatar}}>
                                                {{relticket.assignee_displayname}}
                                            </div>
                                        </a>
                                        <div class="bg-checkbox gray300 small-details inline-btn">
                                            {{relticket.status}}
                                        </div>
                                        <div class="bg-checkbox orange small-details inline-bt">
                                            {{relticket.type}}
                                        </div>
                                        <!--<div class="bg-checkbox inline-bt link-btn">-->
                                            <!--<i class="main-icon-2-more-1 color-green500"></i>-->
                                        <!--</div>-->
                                    </div>

                                </div>
                            </div>

                        </div>
                        <!-- end -->

                    </div>
                    <div class="col-lg-4 col-sm-12">
                        <!-- PEOPLE -->
                        <div class="people-wrap">
                            <div class="details-wrap people">
                                <div class="details">
                                    <h5>People</h5>
                                </div>
                                <div class="row">
                                    <div>
                                        <div class="notification-time">
                                             submitter
                                        </div>
                                        <div class="people-view">
                                            
                                            <div class="people-view-img cursor-pointer"
                                                 ng-dropover

                                                 ng-dropover-options="{'triggerEvent':'hover',
                                                     'closeOthersOnOpen': true}">

                                                <img src="assets/img/avatar/defaultProfile.png"
                                                     ng-mouseover="getAgentSummaryTooltip(ticket.submitter.displayname,
                                                        ticket.submitter.avatar,
                                                        ticket.submitter.username,
                                                        ticket.submitter._id)"
                                                     class="cursor-pointer"
                                                     ng-src={{ticket.submitter.avatar}}>

                                                <div ng-dropover-contents>
                                                    <div ng-include="'app/views/ui-components/agent-summary.html'"></div>
                                                </div>
                                            </div>
                                            <div class="row people-view-details">
                                                <div class="notification-text ">
                                                    {{ticket.submitter.displayname}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="notification-time">
                                            requester
                                        </div>

                                        <div class="people-view">
                                            
                                            <div class="people-view-img">
                                                <img
                                                        src="assets/img/avatar/defaultProfile.png"
                                                        ng-src={{ticket.requester_avatar}}>
                                            </div>
                                            <div class="row people-view-details">
                                                <div class="notification-text">
                                                    {{ticket.requester_displayname}}

                                                    <i ng-show="ticket.showProfileAddButton"
                                                       class="fa fa-plus-square cursor-pointer"
                                                       ng-click="goToNewProfile(ticket);"></i>
                                                </div>
                                                <!--<ul class="nav navbar-right panel_toolbox">
                                                       <li><i class="fa fa-plus-square" ng-click="deleteSocialContact('facebook');"></i>
                                                       </li>
                                                   </ul>-->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                    <div class="row">
                                        <div>
                                            <div class="edit-assignee-wrapper"
                                                 ng-show="isEditAssignee">
                                                <div class="col-lg-7">
                                                    <div class="form-group">


                                                        <div class="scrollable-dropdown-menu">
                                                            <input type="text" ng-model="newAssignee"
                                                                   uib-typeahead="assignee as assignee.displayname for assignee in assigneeUserData | filter:{displayname:$viewValue}"
                                                                   class="form-control" typeahead-show-hint="true"
                                                                   typeahead-min-length="0"
                                                                   placeholder="Select user/group"
                                                                   typeahead-template-url="customTemplate.html">
                                                        </div>

                                                    </div>
                                                </div>
                                                <div class="col-lg-5">
                                                    <div class="edit-btn-wrapper text-left">
                                                        <div class="bg-checkbox btn btn-circle teal60  inline-btn cursor-pointer"
                                                             ng-click="changeAssignee()">
                                                            <i class="fa fa-check"></i>
                                                        </div>

                                                        <div ng-click="editAssignee()"
                                                             class="btn btn-circle priority-view urgent bg-checkbox inline-btn cursor-pointer" style="font-size: 14px;">
                                                            <i class="fa fa-remove"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="notification-time"
                                                ng-show="ticket.assignee_displayname">
                                                Assignee
                                            </div>
                                            <div class="notification-time"
                                                    ng-show="ticket.assignee_group.name">
                                                Group
                                            </div>

                                            <div class="people-view cursor-pointer"
                                                 ng-show="!isEditAssignee"
                                                 ng-mouseleave="isEnableEdit=false"
                                                 ng-mouseover="isEnableEdit=true">

                                                <div class="people-view-img "
                                                     ng-dropover
                                                     ng-dropover-options="{'triggerEvent':'hover',
                                                      'closeOthersOnOpen': true}">
                                                    <img src="assets/img/avatar/defaultProfile.png"
                                                         ng-mouseover="getAgentSummaryTooltip(ticket.assignee_displayname,
                                                         ticket.assignee.avatar,
                                                         ticket.assignee.username,
                                                         ticket.assignee._id)"
                                                         ng-src={{ticket.assignee.avatar}}>
                                                    <i ng-show="isEnableEdit"
                                                       ng-click="editAssignee()"
                                                       class="fa fa-pencil btn-circle btn-template-primary"></i>

                                                    <div ng-dropover-contents>
                                                        <div ng-include="'app/views/ui-components/agent-summary.html'"></div>
                                                    </div>
                                                </div>
                                                <div class="row people-view-details">
                                                
                                                    <div class="notification-text" ng-show="ticket.assignee.name">
                                                        {{ticket.assignee_displayname}}
                                                    </div>

                                                    <!--<div class="notification-time text-uppercase bold color-green500"
                                                         ng-if="!ticket.assignee.name"
                                                         ng-show="ticket.assignee_group.name">
                                                        GROUP
                                                    </div>-->
                                                    <div class="notification-text" ng-if="!ticket.assignee.name"
                                                         ng-show="ticket.assignee_group">
                                                        {{ticket.assignee_group.name}}
                                                    </div>
                                                    <a ng-show="(ticket.assignee || ticket.assignee_group) && ticket.assignee._id!=myProfileID"
                                                       ng-click="assignToMe()" class="assign-me">Assign to me</a>

                                                </div>

                                            </div>
                                        </div>
                                    </div>

                            </div>
                        </div>
                        <!-- END PEOPLE -->

                        <!-- COLLABORATORS -->
                        <div class="collaborators-wrapper">
                            <div class="details">
                                <h5> Collaborators
                                    <!--<div class="pull-right right-icon">-->
                                    <!--<i class="main-icon-2-add"> </i>-->
                                    <!--</div>-->
                                </h5>
                            </div>
                            <div ng-repeat="collaborator in ticket.collaborators">
                                <div class="sub-task">
                                    <div class="pull-left  ">
                                        <div class="pull-left commenter-img"
                                             ng-dropover
                                             ng-dropover-options="{'triggerEvent':'hover',
                                                      'closeOthersOnOpen': true}">
                                            <img src="assets/img/avatar/defaultProfile.png"
                                                 ng-mouseover="getAgentSummaryTooltip(collaborator.displayname,
                                                         collaborator.avatar,
                                                         collaborator.username,
                                                         collaborator._id)"
                                                 ng-src="{{collaborator.avatar}}"/>
                                            <div ng-dropover-contents class="arrowed">
                                                <div ng-include="'app/views/ui-components/agent-summary.html'"></div>
                                            </div>
                                            {{collaborator.displayname}}
                                        </div>
                                    </div>
                                    <div class="pull-right">
                                        <div class="bg-checkbox small-details inline-btn">
                                            {{collaborator.loggedTime}}
                                        </div>
                                    </div>
                                </div>
                            </div>


                        </div>
                        <!-- END -->

                        <!-- WATCHERS -->
                        <div class="collaborators-wrapper">
                            <div class="details">
                                <h5 class="pull-left" style="margin-top: 10px;"> Watchers
                                    <!--<div class="pull-right right-icon">-->
                                    <!--<i class="main-icon-2-add"> </i>-->
                                    <!--</div>-->
                                </h5>


                                <div class="pull-right ">
                                        <a ng-show="isWatching" href="javascript:void(0);" ng-click="stopWatchTicket()" title="Stop watching" style="display: inline-block">
                                            <div class="btn-template-primary btn-circle">
                                                <i class="fa fa-eye-slash"></i>
                                            </div>
                                        </a>
                                        <a ng-show="!isWatching" href="javascript:void(0);" ng-click="watchTicket()" title="Start watching" style="display: inline-block">
                                            <div class="btn-template-primary btn-circle">
                                                <i class="fa fa-eye"></i>
                                            </div>
                                        </a>
                                    
                                </div>
                            </div>

                            <div class="sub-task">
                                <div class="pull-left  ">
                                    <div class="pull-left commenter-img">

                                        <div ng-if="ticket.watchers.length==1">
                                            <div ng-if="ticket.watchers.length==1"
                                                 class="bg-checkbox small-details inline-btn">
                                                {{ticket.watchers.length}}
                                            </div>
                                            user is watching this
                                        </div>
                                        <div ng-if="ticket.watchers.length==1 && isWatching">You are watching this</div>
                                        <div ng-if="ticket.watchers.length>1">
                                            <div class="bg-checkbox small-details inline-btn">
                                                {{ticket.watchers.length}}
                                            </div>
                                            users are watching this
                                        </div>
                                        <div ng-if="ticket.watchers.length==0">No users watching this</div>


                                    </div>
                                </div>

                            </div>


                        </div>
                        <!-- END -->

                        <!-- TIME TRACKING  -->
                        <div class="collaborators-wrapper">
                            <div class="details">
                                <h5 class="pull-left"  style="margin-top: 10px;"> Time Tracking</h5>

                                <div class="pull-right btn-template-primary btn-circle pull-right cursor-pointer" ng-show="!isTimeEdit"
                                          ng-click="isTimeEdit=!isTimeEdit" title="Edit time">
                                        <i class="fa fa-pencil"></i>
                                </div>
                            </div>
                            <div class=" time-wrapper">
                                <div class="row">
                                    <div class="col-sm-3">
                                        Estimated
                                    </div>
                                    <div class="col-sm-6">
                                        <div ng-show="!isTimeEdit">
                                            <uib-progressbar value="ticketEstimatedPrecentage" type="warning">
                                            </uib-progressbar>
                                        </div>

                                        <div ng-show="isTimeEdit">
                                            <input class="form-control" ng-model="newTicketEstimatedTimeFormat" type="text"
                                                   placeholder="00d:00h:00m:00s">
                                            <div class="row">
                                                <div class="row">
                                                    <small class="pull-right" style="color: red" ng-show="!isValidTime">
                                                        {{timeValidateMessage}}
                                                    </small>
                                                </div>
                                            </div>
                                        </div>


                                    </div>

                                    <span ng-show="isTimeEdit">
                                        <button class="btn btn-circle teal600 fa fa-check btn-ticket-time-edit" ng-click="updateTicketEstimatedTime()"></button>
                                        <button class="btn btn-circle priority-view urgent btn-ticket-time-edit fa fa-remove" ng-click="isTimeEdit=!isTimeEdit"></button>

                                    </span>
                                    

                                    <div class="col-sm-3 nopadding" ng-show="!isTimeEdit">
                                        <h6>{{ticketEstimatedTimeFormat}}</h6>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-3">
                                        Remaining
                                    </div>
                                    <div class="col-sm-6">
                                        <uib-progressbar value="ticketRemainingPrecentage" type="success">
                                        </uib-progressbar>

                                    </div>
                                    <div class="col-sm-3 nopadding">
                                        <h6>{{ticketRemainingTimeFormat}}</h6>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-3">
                                        Logged
                                    </div>
                                    <div class="col-sm-6">
                                        <uib-progressbar value="ticketLoggedPrecentage" type="danger">
                                        </uib-progressbar>

                                    </div>
                                    <div class="col-sm-3 nopadding">
                                        <h6>{{ticketLoggedTimeFormat}}</h6>
                                    </div>
                                </div>
                            </div>


                        </div>
                        <!-- END -->

                        <!-- Security Level
                        <div class="collaborators-wrapper" style="margin-top: 35px;">
                            <div class="details">
                                <h5 class="bold"> SECURITY LEVEL

                                </h5>

                            </div>
                            <div class=" time-wrapper">
                                <div class="row">
                                    <rzslider
                                    rz-slider-model="ticket.security_level"
                                    rz-slider-options="slider.options"></rzslider>

                                </div>
                                <div class="model-btn-wrapper">
                                    <div class="btn-warp ">
                                <span class="btn btn-default"
                                      ng-click="updateSecurityLevel();">Save</span>
                                    </div>
                                </div>

                            </div>


                        </div>
                         END -->
                    </div>
                </div>
            </div>
        </div>


        <!-- ACTIVITY -->
        <div class="row">
            <div class="col-lg-12">
                <div class="ticker-tab-wrapper ticket-comments">
                    <div class="tab-wrap ">
                        <!--<uib-tabset class="ticket-tab-panle" active="active">
                            <uib-tab index="$index + 1" ng-repeat="tab in tabs" heading="{{tab.title}}"
                                     disable="tab.disabled">
                                <uib-tab-heading>
                                    <i class="{{tab.icon}}"></i> {{tab.title}}
                                </uib-tab-heading>

                                <div ng-switch on="tab.type">
                                    <div ng-switch-when="comments" id="ticket_comments_panel">
                                        <div ng-include="'app/views/ticket/template/comments.html'"></div>
                                    </div>
                                    <div ng-switch-when="activity">
                                        <div ng-include="'app/views/ticket/template/activity.html'"></div>
                                    </div>
                                    <div ng-switch-when="other">
                                        <div ng-include="'app/views/ticket/template/other.html'"></div>
                                    </div>
                                </div>
                            </uib-tab>
                        </uib-tabset>-->

                        <uib-tabset class="ticket-tab-panle" active="active">
                            <uib-tab index="0" heading="COMMENTS" >
                                <uib-tab-heading>
                                    <i class="main-icon-2-communication"></i> COMMENTS
                                </uib-tab-heading>
                                <div ng-include="'app/views/ticket/template/comments.html'"></div>
                            </uib-tab>
                            <uib-tab index="1" heading="ACTIVITY" >
                                <uib-tab-heading>
                                    <i class="main-icon-2-star"></i> ACTIVITY
                                </uib-tab-heading>
                                <div ng-include="'app/views/ticket/template/activity.html'"></div>
                            </uib-tab>
                            <uib-tab index="2" heading="OTHER" >
                                <uib-tab-heading>
                                    <i class="main-icon-2-star"></i> OTHER
                                </uib-tab-heading>
                                <div ng-include="'app/views/ticket/template/other.html'"></div>
                            </uib-tab>
                        </uib-tabset>
                    </div>

                </div>
            </div>
        </div>
        <!-- END ACTIVITY -->

    </div>

    <a href="" id="image-viewer" data-lightbox="image-1" data-title=""></a>

</div>
